{"componentChunkName":"component---src-templates-post-jsx","path":"/Sauna/","result":{"data":{"site":{"siteMetadata":{"title":"𝓃u⚡︎3114 β10g"}},"markdownRemark":{"id":"78bc815d-f444-5efc-8f0f-c75019292655","excerpt":"Sauna 요약  🌟 한 줄 평 액티브 디렉토리의 기본적인 공격 요소 및 정보 수집 방법들을 경험할 수 있는 시스템인데, 잘 만들었다고 소문난 Pro Labs의 Dante를 만든 제작자 (egotisticalSW)가 만든 시스템이라 그런지 핵더박스내에서도 인기가 높다.  사우나는 Active Directory 열거 및 활용 기능을 갖춘 쉬운 난이도의 윈도…","html":"<h2 id=\"Sauna-요약\" style=\"position:relative;\"><a href=\"#Sauna-%EC%9A%94%EC%95%BD\" aria-label=\"Sauna 요약 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Sauna 요약</h2>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/4a06e187-1d98-4268-9540-f1c4a459e2df/image.png\"></p>\n<blockquote>\n<p>🌟 <strong>한 줄 평</strong></p>\n<p>액티브 디렉토리의 기본적인 공격 요소 및 정보 수집 방법들을 경험할 수 있는 시스템인데, 잘 만들었다고 소문난 Pro Labs의 Dante를 만든 제작자 (egotisticalSW)가 만든 시스템이라 그런지 핵더박스내에서도 인기가 높다. </p>\n</blockquote>\n<p>사우나는 Active Directory 열거 및 활용 기능을 갖춘 쉬운 난이도의 윈도우즈 시스템이다. </p>\n<p>웹사이트에 나와 있는 직원 이름을 활용하여 사용자 이름 리스트를 만들어 ASREPRoasting 공격에 사용하면 컬브로스 사전 인증 (Kerberos pre-authentication)이 필요하지 않은 계정에 대한 해시를 얻을 수 있다. 이 해시를 이용하여 오프라인 무차별 대입 공격 (Offline brute force attack)을 수행 하게 되면 WinRM을 실행 할 수 있는 사용자 계정의 일반 텍스트 비밀번호를 얻을 수 있다. </p>\n<p>권한상승을 위한 정보 수집으로 WinPEAS를 실행하면 다른 시스템 사용자가 자동 로그인 설정을 해두었다는 사실과 비밀번호를 함께 확인 할 수 있다. 블러드하운드 (BloodHound)를 이용하면 이 사용자에게는 디씨씽크 (DCSync) 공격 시 도메인 컨트롤러에서 암호 해시를 덤프할 수 있는 <code class=\"language-text\">DS-Replication-Get-Changes-All</code> 확장 권한이 있다는 것을 알 수 있다. 이 공격을 실행하면 주 도메인 관리자의 해쉬를 얻을 수 있으며 이는 임패킷 (Impacket)의 피에스이그젝 (psexec.py)과 함께 사용함으로써 상승된 권한인 <code class=\"language-text\">NT_AUTHORITY\\SYSTEM</code> 으로써 쉘을 열 수 있다. </p>\n<h2 id=\"정보-수집\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%B3%B4-%EC%88%98%EC%A7%91\" aria-label=\"정보 수집 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>정보 수집</h2>\n<h3 id=\"Nmap-포트-스캔\" style=\"position:relative;\"><a href=\"#Nmap-%ED%8F%AC%ED%8A%B8-%EC%8A%A4%EC%BA%94\" aria-label=\"Nmap 포트 스캔 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>Nmap 포트 스캔</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">PORT      STATE SERVICE                    \n<span class=\"token number\">53</span>/tcp    <span class=\"token function\">open</span>  domain \n<span class=\"token number\">80</span>/tcp    <span class=\"token function\">open</span>  http\n<span class=\"token number\">88</span>/tcp    <span class=\"token function\">open</span>  kerberos-sec\n<span class=\"token number\">135</span>/tcp   <span class=\"token function\">open</span>  msrpc\n<span class=\"token number\">139</span>/tcp   <span class=\"token function\">open</span>  netbios-ssn\n<span class=\"token number\">389</span>/tcp   <span class=\"token function\">open</span>  ldap\n<span class=\"token number\">445</span>/tcp   <span class=\"token function\">open</span>  microsoft-ds                          \n<span class=\"token number\">464</span>/tcp   <span class=\"token function\">open</span>  kpasswd5\n<span class=\"token number\">593</span>/tcp   <span class=\"token function\">open</span>  http-rpc-epmap\n<span class=\"token number\">636</span>/tcp   <span class=\"token function\">open</span>  ldapssl\n<span class=\"token number\">3268</span>/tcp  <span class=\"token function\">open</span>  globalcatLDAP              \n<span class=\"token number\">3269</span>/tcp  <span class=\"token function\">open</span>  globalcatLDAPssl\n<span class=\"token number\">5985</span>/tcp  <span class=\"token function\">open</span>  wsman\n<span class=\"token number\">9389</span>/tcp  <span class=\"token function\">open</span>  adws\n<span class=\"token number\">49667</span>/tcp <span class=\"token function\">open</span>  unknown\n<span class=\"token number\">49669</span>/tcp <span class=\"token function\">open</span>  unknown\n<span class=\"token number\">49670</span>/tcp <span class=\"token function\">open</span>  unknown\n<span class=\"token number\">49671</span>/tcp <span class=\"token function\">open</span>  unknown\n<span class=\"token number\">49681</span>/tcp <span class=\"token function\">open</span>  unknown\n<span class=\"token number\">64471</span>/tcp <span class=\"token function\">open</span>  unknown</code></pre></div>\n<ul>\n<li>디렉토리 퍼징 (Directory Fuzzing) 에서는 딱히 눈에 띄는 폴더는 없었다. </li>\n<li>LDAP을 열거하면 도메인명 <code class=\"language-text\">egotistical-bank.local</code> 을 확인 할 수 있다. </li>\n</ul>\n<h3 id=\"80-HTTP\" style=\"position:relative;\"><a href=\"#80-HTTP\" aria-label=\"80 HTTP permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>80-HTTP</h3>\n<p><code class=\"language-text\">http://egotistical-bank.local/about.html</code> 로 접속하면 직원들의 이름을 확인할 수 있다. </p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/be597dbd-270e-439f-9379-9d46daf99b85/image.png\"></p>\n<h3 id=\"유저네임-얻기\" style=\"position:relative;\"><a href=\"#%EC%9C%A0%EC%A0%80%EB%84%A4%EC%9E%84-%EC%96%BB%EA%B8%B0\" aria-label=\"유저네임 얻기 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>유저네임 얻기</h3>\n<p>나중에 찾아보니 <a href=\"https://github.com/ropnop/kerbrute\">Kerbrute</a>를 활용해 좀 더 간결하고 스마트하게 사용자명을 얻는 방법이 있으나 나는 다른 방법으로 얻었다.</p>\n<blockquote>\n<p>Kerbrute를 활용하는 방법은 <a href=\"https://0xdf.gitlab.io/2020/07/18/htb-sauna.html#recon\">이 문제풀이</a> 참조. </p>\n</blockquote>\n<p><a href=\"https://github.com/urbanadventurer/username-anarchy\">Username anarchy</a>를 이용하여 직원들의 풀네임을 넣으면 그걸 치환해 유저네임 형식으로 바꿔주는데 다양한 형식의 유저네임 리스트를 ASREPRoasting 공격에 넣어 얻어 걸리길 기도하는 방법이다. </p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/88c244c4-5d61-4be2-8646-8c54a7caf1cc/image.png\"></p>\n<h2 id=\"ASREPRoasting--해시-얻기\" style=\"position:relative;\"><a href=\"#ASREPRoasting--%ED%95%B4%EC%8B%9C-%EC%96%BB%EA%B8%B0\" aria-label=\"ASREPRoasting  해시 얻기 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>ASREPRoasting / 해시 얻기</h2>\n<h3 id=\"ASREPRoating-개념\" style=\"position:relative;\"><a href=\"#ASREPRoating-%EA%B0%9C%EB%85%90\" aria-label=\"ASREPRoating 개념 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>ASREPRoating 개념</h3>\n<p>구글링을 하다보면 글이 길고 설명이 복잡한것들이 대부분인데, <a href=\"https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html#as-rep-roasting\">이 포스트</a>가 간결하고 쉽게 잘 설명한 것 같다. </p>\n<p>위 포스트를 요약하자면, </p>\n<ul>\n<li>사전 인증은 Kerberos 인증의 첫 번째 단계이며 주요 역할은 무차별 암호 추측 공격을 방지하는 것임. </li>\n<li>사전 인증 절차 중, 사용자는 타임스탬프를 암호화하는데 사용할 자격증명을 입력함. </li>\n<li>DC는 이를 해독하여 올바른 자격 증명이 사용되었는지 확인함. </li>\n<li>DC가 승인하면 TGT를 발행.</li>\n<li>사전 인증이 비활성화되면 공격자가 _모든 _사용자에 대한 티켓을 요청할 수 있음.</li>\n<li>따라서 명시적으로 계정에 <code class=\"language-text\">DONT_REQ_PREAUTH</code> (사전 인증 비활성화) 라는 설정이 있어야 가능한 공격임. </li>\n<li>그럼 DC는 오프라인에서 크랙할 수 있는 Kerberoast 공격과 유사하게 암호화된 TGT를 반환함. </li>\n</ul>\n<p>우선 컬브로스 88번 포트가 열려 있고, 윈도우즈 시스템이고, 사전인증이 비활성화된 계정이 있다면 시도해볼만 한 공격인 것 같다. </p>\n<h3 id=\"ASREPRoasting-시도\" style=\"position:relative;\"><a href=\"#ASREPRoasting-%EC%8B%9C%EB%8F%84\" aria-label=\"ASREPRoasting 시도 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>ASREPRoasting 시도</h3>\n<p>아래의 명령어를 입력해 위에서 만든 유저네임 리스트를 넣어 Impacket의 GetNPUsers를 사용해 ASREPRoasting 공격을 실행, 아웃풋으로 나온 해시를 <code class=\"language-text\">hash.txt</code> 파일에 저장한다. </p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token keyword\">while</span> <span class=\"token builtin class-name\">read</span> p<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> impacket-GetNPUsers egotistical-bank.local/<span class=\"token string\">\"<span class=\"token variable\">$p</span>\"</span> <span class=\"token parameter variable\">-request</span> -no-pass -dc-ip <span class=\"token number\">10.10</span>.10.175 <span class=\"token operator\">>></span> hash.txt<span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span> <span class=\"token operator\">&lt;</span> unames.txt</code></pre></div>\n<p>그러면 아래와 같이 <code class=\"language-text\">fsmith</code> 사용자의 컬브로스 해쉬를 얻을 수 있다. </p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/55f4b870-d498-48b7-969a-6d4cd964d98a/image.png\"></p>\n<p>일반 텍스트 비밀번호를 얻기 위해 해쉬캣을 이용해 무차별 대입을 하면 된다. </p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">hashcat <span class=\"token parameter variable\">-m</span> <span class=\"token number\">18200</span> fsmithhash /usr/share/wordlists/rockyou.txt <span class=\"token parameter variable\">--force</span></code></pre></div>\n<p>해쉬캣 모드는 <code class=\"language-text\">hashcat --help | grep Kerberos</code>를 입력해, <code class=\"language-text\">AS-REP</code> 이라고 적힌 모드 번호를 사용한다. </p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/78b5413e-a491-483c-8936-f1744512efba/image.png\"></p>\n<p>그러면 이렇게 크랙된 비밀번호를 얻을 수 있다. </p>\n<ul>\n<li>유저네임: <code class=\"language-text\">fsmith</code></li>\n<li>비밀번호: <code class=\"language-text\">Thestrokes23</code></li>\n</ul>\n<h2 id=\"초입\" style=\"position:relative;\"><a href=\"#%EC%B4%88%EC%9E%85\" aria-label=\"초입 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>초입</h2>\n<p>Evil-WinRM을 이용하여 새로 얻은 로그인 자격증명을 넣으면 초입에 성공할 수 있다. </p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/43b2d8fa-fe29-411c-97df-7fd457d3aebf/image.png\"></p>\n<h2 id=\"권한상승\" style=\"position:relative;\"><a href=\"#%EA%B6%8C%ED%95%9C%EC%83%81%EC%8A%B9\" aria-label=\"권한상승 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>권한상승</h2>\n<h3 id=\"정보-수집-1\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%B3%B4-%EC%88%98%EC%A7%91-1\" aria-label=\"정보 수집 1 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>정보 수집</h3>\n<p><a href=\"https://github.com/peass-ng/PEASS-ng/blob/master/winPEAS/winPEASexe/README.md\">WinPEAS</a>를 실행하면 아래와 같이 자동로그인이 활성화된 계정정보를 비밀번호와 함께 얻을 수 있다. </p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/7143ac67-0377-4a57-b206-1d392687d4c0/image.png\"></p>\n<ul>\n<li>유저네임: <code class=\"language-text\">svc_loanmanager</code></li>\n<li>비밀번호: <code class=\"language-text\">Moneymakestheworldgoround!</code></li>\n</ul>\n<h3 id=\"시도\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%8F%84\" aria-label=\"시도 permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>시도</h3>\n<p>초입 방식와 같이 새로 얻은 자격증명을 활용해 Evil WinRM을 통해 연결해보자. </p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/779305e0-89f4-430f-a9bf-9435496ee062/image.png\"></p>\n<h2 id=\"블러드하운드-BloodHound\" style=\"position:relative;\"><a href=\"#%EB%B8%94%EB%9F%AC%EB%93%9C%ED%95%98%EC%9A%B4%EB%93%9C-BloodHound\" aria-label=\"블러드하운드 BloodHound permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>블러드하운드 (BloodHound)</h2>\n<p><a href=\"https://github.com/SpecterOps/BloodHound-Legacy\">블러드하운드</a>를 사용하면 액티브디렉토리 도메인 열거 및 시각화를 할 수 있는데 권한상승을 위한 정보 수집시 가이드 역할을 해주는 아주 유용한 툴이다. </p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/ee48adf9-5457-41dc-af91-e94e39c5235f/image.png\"></p>\n<p><code class=\"language-text\">Queries</code> 탭에서 <code class=\"language-text\">Find Principals with DCSync Rights</code> 를 클릭하면 현 사용자가 <code class=\"language-text\">GetChangesAll</code>을 통해 도메인과 연결이 된 것을 볼 수 있다.</p>\n<p>가장자리를 우클릭하고 <code class=\"language-text\">Help</code>를 클릭하면 svc_loanmgr(현 사용자)가 DCSync 공격을 사용하여 도메인 컨트롤러에서 비밀번호 해시를 덤프할 수 있음을 알 수 있다.</p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/63046407-49dc-4d39-828d-1a0461df8a88/image.png\"></p>\n<h2 id=\"디씨씽크-DCSync\" style=\"position:relative;\"><a href=\"#%EB%94%94%EC%94%A8%EC%94%BD%ED%81%AC-DCSync\" aria-label=\"디씨씽크 DCSync permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>디씨씽크 (DCSync)</h2>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/8682c72b-2a15-43ad-984b-c520fd415b15/image.png\"></p>\n<p>이렇게 하면 관리자의 해쉬를 얻을 수 있다.\n이 방법 외에도 미미켓즈 (Mimikatz)를 타겟에서 실행해 관리자 해쉬를 얻는 방법, 디씨씽크를 통해 얻은 해쉬를 Evil-WinRM에 그대로 넣어 관리자로써 연결하는 방법이 있다고 한다. </p>\n<h2 id=\"패스더해시-PtH\" style=\"position:relative;\"><a href=\"#%ED%8C%A8%EC%8A%A4%EB%8D%94%ED%95%B4%EC%8B%9C-PtH\" aria-label=\"패스더해시 PtH permalink\" class=\"heading-anchor before\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"15\" height=\"15\" viewBox=\"0 0 24 24\"><path d=\"M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z\"/></svg></a>패스더해시 (PtH)</h2>\n<p>나는 해쉬를 임패켓 (Impacket) 피에스이그젝 (psexec.py)에 넣어 패스하는 방법을 택했다. </p>\n<p><img src=\"https://velog.velcdn.com/images/h3llanut3lla/post/bb50f669-d675-4dc1-b889-b7e982d0b215/image.png\"></p>","frontmatter":{"title":"Sauna","date":"February 09, 2025","update":"February 09, 2025","tags":["HTB","ASREPRoasting","PtH","DCSync","윈도우즈"],"series":null},"fields":{"slug":"/Sauna/","readingTime":{"minutes":8.275}}},"seriesList":{"edges":[{"node":{"id":"11b1c1ba-0892-55bb-a8b4-12725a60634b","fields":{"slug":"/Broker/"},"frontmatter":{"title":"Broker"}}},{"node":{"id":"2de10886-d77d-5ae4-8d82-3c252f0872e9","fields":{"slug":"/Editorial/"},"frontmatter":{"title":"Editorial"}}},{"node":{"id":"78bc815d-f444-5efc-8f0f-c75019292655","fields":{"slug":"/Sauna/"},"frontmatter":{"title":"Sauna"}}},{"node":{"id":"f3e63794-05fc-5137-8062-c9a4261c6ff5","fields":{"slug":"/Timelapse/"},"frontmatter":{"title":"Timelapse"}}},{"node":{"id":"e8b68538-12a5-5e25-b0aa-d336c2072f24","fields":{"slug":"/about/"},"frontmatter":{"title":"안녕하세요"}}}]},"previous":{"fields":{"slug":"/Editorial/"},"frontmatter":{"title":"Editorial"}},"next":{"fields":{"slug":"/Timelapse/"},"frontmatter":{"title":"Timelapse"}}},"pageContext":{"id":"78bc815d-f444-5efc-8f0f-c75019292655","series":null,"previousPostId":"2de10886-d77d-5ae4-8d82-3c252f0872e9","nextPostId":"f3e63794-05fc-5137-8062-c9a4261c6ff5"}},"staticQueryHashes":[],"slicesMap":{}}